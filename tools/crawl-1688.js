import puppeteer from 'puppeteer-extra';import StealthPlugin from 'puppeteer-extra-plugin-stealth';import fs from 'fs';puppeteer.use(StealthPlugin());(async()=>{const ck=process.env.COOKIE_1688;if(!ck){console.error('缺少 COOKIE_1688');process.exit(1);}const browser=await puppeteer.launch({headless:'new',args:['--no-sandbox']});const page=await browser.newPage();await page.setExtraHTTPHeaders({'Cookie':ck});await page.goto('https://tiyicj.1688.com/page/offerlist.htm',{waitUntil:'networkidle2'});let prev=0;while(true){const h=await page.evaluate('document.body.scrollHeight');if(h===prev)break;prev=h;await page.evaluate('window.scrollTo(0,document.body.scrollHeight)');await page.waitForTimeout(1200);}const items=await page.evaluate(()=>{const res=[];document.querySelectorAll('.offer').forEach(el=>{res.push({title:el.querySelector('.offer-title')?.textContent?.trim()||'',sku:el.getAttribute('data-offerid')||'',price:parseFloat(el.querySelector('.price')?.textContent?.replace(/[^\d.]/g,'')||'0'),imageUrl:el.querySelector('img')?.src||''});});return res;});fs.mkdirSync('public/data',{recursive:true});fs.writeFileSync('public/data/products.json',JSON.stringify(items,null,2));await browser.close();})();