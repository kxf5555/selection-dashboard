import React,{useEffect,useState}from'react';import{Card,CardContent}from'@/components/ui/card';import{Button}from'@/components/ui/button';import{Input}from'@/components/ui/input';import{Table,TableHeader,TableRow,TableHead,TableBody,TableCell}from'@/components/ui/table';interface Product{title:string;sku:string;price:number;imageUrl:string;}interface Kpi{label:string;value:string;}export default function Dashboard(){const[products,setProducts]=useState<Product[]>([]);const[kpis,setKpis]=useState<Kpi[]>([]);const[csvFile,setCsvFile]=useState<File|null>(null);useEffect(()=>{fetch('/data/products.json').then(r=>r.ok?r.json():[]).then((d:Product[])=>setProducts(d)).catch(()=>{});},[]);const parseCsv=(txt:string)=>{const rows=txt.trim().split(/\r?\n/);const header=rows.shift()?.split(',')||[];const list:Product[]=rows.map(r=>{const c=r.split(',');return{title:c[header.indexOf('title')],sku:c[header.indexOf('sku')],price:parseFloat(c[header.indexOf('price')]),imageUrl:c[header.indexOf('imageUrl')]};});setProducts(list);};const handleCsv=()=>{if(!csvFile)return;const reader=new FileReader();reader.onload=e=>parseCsv(e.target?.result as string);reader.readAsText(csvFile,'utf-8');setCsvFile(null);};useEffect(()=>{if(products.length){const avg=(products.reduce((s,p)=>s+p.price,0)/products.length).toFixed(2);setKpis([{label:'SKU 数',value:String(products.length)},{label:'平均批价',value:`¥${avg}`}]);}},[products]);return(<div className='min-h-screen p-6 space-y-8'><header className='flex items-center justify-between'><h1 className='text-2xl font-bold'>选品评估仪表盘</h1><div className='flex items-center gap-3'><label className='flex items-center gap-1.5 cursor-pointer'><Input type='file'accept='.csv'className='hidden'onChange={e=>setCsvFile(e.target.files?.[0]||null)}/><Button variant='secondary'>导入 CSV</Button></label><Button onClick={handleCsv} disabled={!csvFile}>处理</Button></div></header><section className='grid sm:grid-cols-2 lg:grid-cols-4 gap-4'>{kpis.map(k=>(<Card key={k.label}><CardContent><p className='text-sm text-gray-500'>{k.label}</p><p className='text-xl font-bold'>{k.value}</p></CardContent></Card>))}</section><section className='bg-white rounded-2xl shadow p-4'><h2 className='text-lg font-medium mb-4'>商品列表</h2><div className='overflow-auto'><Table><TableHeader><TableRow><TableHead>SKU</TableHead><TableHead>标题</TableHead><TableHead>批价</TableHead><TableHead>图片</TableHead></TableRow></TableHeader><TableBody>{products.map(p=>(<TableRow key={p.sku}><TableCell>{p.sku}</TableCell><TableCell>{p.title}</TableCell><TableCell>¥{p.price}</TableCell><TableCell><img src={p.imageUrl}alt=''className='w-12'/></TableCell></TableRow>))}</TableBody></Table></div></section></div>);}